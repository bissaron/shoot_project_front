{"ast":null,"code":"import Swal from \"sweetalert2\";\nexport default {\n  data() {\n    return {\n      userItems: [],\n      editedUser: {},\n      editDialog: false,\n      roles: [\"customer\", \"owner\"],\n      headers: [{\n        text: \"#\",\n        align: \"center\",\n        sortable: false,\n        value: \"index\"\n      }, {\n        text: \"ชื่อผู้ใช้\",\n        align: \"start\",\n        sortable: false,\n        value: \"username\"\n      }, {\n        text: \"ชื่อจริง\",\n        align: \"start\",\n        sortable: false,\n        value: \"fname\"\n      }, {\n        text: \"นามสกุล\",\n        align: \"start\",\n        value: \"lname\"\n      }, {\n        text: \"เบอร์มือถือ\",\n        align: \"start\",\n        value: \"c_tel\"\n      }, {\n        text: \"บทบาท\",\n        align: \"start\",\n        value: \"role\"\n      }, {\n        text: \"Actions\",\n        align: \"center\",\n        value: \"actions\",\n        sortable: false\n      }]\n    };\n  },\n  created() {\n    this.getAllUser();\n  },\n  computed: {\n    indexedUserItems() {\n      return this.userItems.map((user, index) => {\n        return {\n          ...user,\n          index: index + 1,\n          c_tel: user.c_tel || \"-\"\n        };\n      });\n    }\n  },\n  methods: {\n    async getAllUser() {\n      try {\n        const response = await this.axios.get(process.env.VUE_APP_API_SERVER + `/user`);\n        if (response.status == 200) {\n          this.userItems = response.data;\n        }\n      } catch (err) {\n        console.error(err);\n      }\n    },\n    async deleteItem(user) {\n      Swal.fire({\n        title: \"แจ้งเตือน!\",\n        text: `คุณต้องการลบชื่อผู้ใช้ ${user.username}?`,\n        icon: \"warning\",\n        showCancelButton: true,\n        confirmButtonText: \"ตกลง\",\n        cancelButtonText: \"ยกเลิก\"\n      }).then(async result => {\n        if (result.isConfirmed) {\n          try {\n            const response = await this.axios.delete(process.env.VUE_APP_API_SERVER + `/user/${user.u_id}`);\n            if (response.status === 200) {\n              Swal.fire({\n                title: \"ลบผู้ใช้สำเร็จ!\",\n                // text: \"คุณสมัครสมาชิกสำเร็จ\",\n                icon: \"success\",\n                confirmButtonText: \"ตกลง\",\n                timer: 1500\n              });\n              this.getAllUser();\n            }\n          } catch (err) {\n            Swal.fire({\n              title: \"เกิดข้อผิดพลาด!\",\n              // text: \"คุณสมัครสมาชิกสำเร็จ\",\n              icon: \"error\",\n              confirmButtonText: \"ตกลง\",\n              timer: 1500\n            });\n            console.error(err);\n          }\n        }\n      });\n    },\n    editUser(user) {\n      this.editedUser = {\n        ...user\n      };\n      this.editDialog = true;\n      console.log(this.editedUser);\n    },\n    async saveUserChanges(userId) {\n      let userData = {};\n      if (this.editedUser.role == \"admin\") {\n        userData = {\n          username: this.editedUser.username,\n          password: this.editedUser.password,\n          role: this.editedUser.role,\n          o_fname: this.editedUser.fname,\n          o_lname: this.editedUser.lname\n        };\n      } else {\n        userData = {\n          username: this.editedUser.username,\n          password: this.editedUser.password,\n          role: this.editedUser.role,\n          c_fname: this.editedUser.fname,\n          c_lname: this.editedUser.lname,\n          c_tel: this.editedUser.c_tel\n        };\n      }\n      console.log(\"userData\", userData);\n      console.log(\"userId\", userId);\n      try {\n        const response = await this.axios.put(process.env.VUE_APP_API_SERVER + `/user/${userId}`, userData);\n        if (response.status === 200) {\n          Swal.fire({\n            title: \"แก้ไขข้อมูลผู้ใช้สำเร็จ!\",\n            // text: \"คุณสมัครสมาชิกสำเร็จ\",\n            icon: \"success\",\n            confirmButtonText: \"ตกลง\",\n            timer: 1000\n          });\n          this.getAllUser();\n          this.editDialog = false;\n        }\n        console.log(userData);\n        this.editDialog = false;\n      } catch (error) {\n        Swal.fire({\n          title: \"เกิดข้อผิดพลาด!\",\n          // text: \"คุณสมัครสมาชิกสำเร็จ\",\n          icon: \"error\",\n          confirmButtonText: \"ตกลง\",\n          timer: 1500\n        });\n        console.error(\"error:\", error);\n      }\n    },\n    cancelEdit() {\n      // Reset the editedUser and close the dialog\n      this.editedUser = {};\n      this.editDialog = false;\n    }\n  }\n};","map":{"version":3,"names":["Swal","data","userItems","editedUser","editDialog","roles","headers","text","align","sortable","value","created","getAllUser","computed","indexedUserItems","map","user","index","c_tel","methods","response","axios","get","process","env","VUE_APP_API_SERVER","status","err","console","error","deleteItem","fire","title","username","icon","showCancelButton","confirmButtonText","cancelButtonText","then","result","isConfirmed","delete","u_id","timer","editUser","log","saveUserChanges","userId","userData","role","password","o_fname","fname","o_lname","lname","c_fname","c_lname","put","cancelEdit"],"sources":["src/views/UserListView.vue"],"sourcesContent":["<template>\n  <v-container style=\"padding-top: 50px; padding-bottom: 60px\">\n    <v-btn text @click=\"$router.go(-1)\" style=\"margin-bottom: 20px\">\n      <v-icon left>mdi-arrow-left</v-icon> ย้อนกลับ\n    </v-btn>\n\n    <h2>รายชื่อผู้ใช้ระบบ</h2>\n    <v-row>\n      <v-col\n        style=\"display: flex; justify-content: flex-end; margin-bottom: 20px\"\n      >\n        <v-btn color=\"var(--color-main)\" to=\"/user/add\">เพิ่มผู้ใช้</v-btn>\n      </v-col>\n    </v-row>\n    <v-data-table\n      :headers=\"headers\"\n      :items=\"indexedUserItems\"\n      class=\"elevation-1\"\n    >\n      <template v-slot:[`item.actions`]=\"{ item }\">\n        <v-icon small class=\"mr-2\" @click=\"editUser(item)\"> mdi-pencil </v-icon>\n        <v-icon small @click=\"deleteItem(item)\"> mdi-delete </v-icon>\n      </template>\n    </v-data-table>\n\n    <v-dialog v-model=\"editDialog\" max-width=\"600px\">\n      <v-card>\n        <v-card-title>แก้ไขข้อมูล</v-card-title>\n        <v-card-text>\n          <!-- Your user edit form here -->\n          <v-text-field\n            v-model=\"editedUser.username\"\n            label=\"ชื่อผู้ใช้\"\n          ></v-text-field>\n          <v-text-field\n            v-model=\"editedUser.password\"\n            label=\"รหัสผ่าน\"\n            type=\"password\"\n          ></v-text-field>\n          <v-text-field\n            v-model=\"editedUser.fname\"\n            label=\"ชื่อจริง\"\n          ></v-text-field>\n          <v-text-field\n            v-model=\"editedUser.lname\"\n            label=\"นามสกุล\"\n          ></v-text-field>\n          <v-text-field\n            v-if=\"editedUser.c_tel !== '-'\"\n            v-model=\"editedUser.c_tel\"\n            label=\"เบอรืมือถือ\"\n          ></v-text-field>\n          <!-- <v-select\n                    v-model=\"editedUser.role\"\n                    :items=\"roles\"\n                    label=\"บทบาท\"\n                    required\n                  ></v-select> -->\n          <!-- Add other fields for editing -->\n\n          <!-- Save and Cancel buttons -->\n          <div\n            style=\"\n              display: flex;\n              justify-content: flex-end;\n              align-items: center;\n              margin-top: 10px;\n            \"\n          >\n            <v-btn color=\"primary\" @click=\"saveUserChanges(editedUser.u_id)\"\n              >บันทึก</v-btn\n            >\n            <v-btn style=\"margin-left: 10px\" @click=\"cancelEdit\">ยกเลิก</v-btn>\n          </div>\n        </v-card-text>\n      </v-card>\n    </v-dialog>\n  </v-container>\n</template>\n\n<script>\nimport Swal from \"sweetalert2\";\n\nexport default {\n  data() {\n    return {\n      userItems: [],\n      editedUser: {},\n      editDialog: false,\n      roles: [\"customer\", \"owner\"],\n      headers: [\n        {\n          text: \"#\",\n          align: \"center\",\n          sortable: false,\n          value: \"index\",\n        },\n        {\n          text: \"ชื่อผู้ใช้\",\n          align: \"start\",\n          sortable: false,\n          value: \"username\",\n        },\n        { text: \"ชื่อจริง\", align: \"start\", sortable: false, value: \"fname\" },\n        { text: \"นามสกุล\", align: \"start\", value: \"lname\" },\n        { text: \"เบอร์มือถือ\", align: \"start\", value: \"c_tel\" },\n        { text: \"บทบาท\", align: \"start\", value: \"role\" },\n        { text: \"Actions\", align: \"center\", value: \"actions\", sortable: false },\n      ],\n    };\n  },\n\n  created() {\n    this.getAllUser();\n  },\n\n  computed: {\n    indexedUserItems() {\n      return this.userItems.map((user, index) => {\n        return { ...user, index: index + 1, c_tel: user.c_tel || \"-\" };\n      });\n    },\n  },\n\n  methods: {\n    async getAllUser() {\n      try {\n        const response = await this.axios.get(\n          process.env.VUE_APP_API_SERVER + `/user`\n        );\n        if (response.status == 200) {\n          this.userItems = response.data;\n        }\n      } catch (err) {\n        console.error(err);\n      }\n    },\n    async deleteItem(user) {\n      Swal.fire({\n        title: \"แจ้งเตือน!\",\n        text: `คุณต้องการลบชื่อผู้ใช้ ${user.username}?`,\n        icon: \"warning\",\n        showCancelButton: true,\n        confirmButtonText: \"ตกลง\",\n        cancelButtonText: \"ยกเลิก\",\n      }).then(async (result) => {\n        if (result.isConfirmed) {\n          try {\n            const response = await this.axios.delete(\n              process.env.VUE_APP_API_SERVER + `/user/${user.u_id}`\n            );\n            if (response.status === 200) {\n              Swal.fire({\n                title: \"ลบผู้ใช้สำเร็จ!\",\n                // text: \"คุณสมัครสมาชิกสำเร็จ\",\n                icon: \"success\",\n                confirmButtonText: \"ตกลง\",\n                timer: 1500,\n              });\n              this.getAllUser();\n            }\n          } catch (err) {\n            Swal.fire({\n              title: \"เกิดข้อผิดพลาด!\",\n              // text: \"คุณสมัครสมาชิกสำเร็จ\",\n              icon: \"error\",\n              confirmButtonText: \"ตกลง\",\n              timer: 1500,\n            });\n            console.error(err);\n          }\n        }\n      });\n    },\n    editUser(user) {\n      this.editedUser = { ...user };\n      this.editDialog = true;\n      console.log(this.editedUser);\n    },\n    async saveUserChanges(userId) {\n      let userData = {};\n      if (this.editedUser.role == \"admin\") {\n        userData = {\n          username: this.editedUser.username,\n          password: this.editedUser.password,\n          role: this.editedUser.role,\n          o_fname: this.editedUser.fname,\n          o_lname: this.editedUser.lname,\n        };\n      } else {\n        userData = {\n          username: this.editedUser.username,\n          password: this.editedUser.password,\n          role: this.editedUser.role,\n          c_fname: this.editedUser.fname,\n          c_lname: this.editedUser.lname,\n          c_tel: this.editedUser.c_tel,\n        };\n      }\n      console.log(\"userData\", userData);\n      console.log(\"userId\", userId);\n      try {\n        const response = await this.axios.put(\n          process.env.VUE_APP_API_SERVER + `/user/${userId}`,\n          userData\n        );\n        if (response.status === 200) {\n          Swal.fire({\n            title: \"แก้ไขข้อมูลผู้ใช้สำเร็จ!\",\n            // text: \"คุณสมัครสมาชิกสำเร็จ\",\n            icon: \"success\",\n            confirmButtonText: \"ตกลง\",\n            timer: 1000,\n          });\n          this.getAllUser();\n          this.editDialog = false;\n        }\n\n        console.log(userData);\n        this.editDialog = false;\n      } catch (error) {\n        Swal.fire({\n          title: \"เกิดข้อผิดพลาด!\",\n          // text: \"คุณสมัครสมาชิกสำเร็จ\",\n          icon: \"error\",\n          confirmButtonText: \"ตกลง\",\n          timer: 1500,\n        });\n\n        console.error(\"error:\", error);\n      }\n    },\n    cancelEdit() {\n      // Reset the editedUser and close the dialog\n      this.editedUser = {};\n      this.editDialog = false;\n    },\n  },\n};\n</script>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}